### **项目说明：微信公众号文章一键同步到多平台 Chrome 插件（V2）**

#### 1. 项目目标

开发一款 Chrome 浏览器插件，实现从用户当前浏览的微信公众号文章页面一键提取内容，并同步到多平台的功能。

#### 2. 核心功能需求

1.  **内容采集**：
    * 当用户在微信公众号文章页面（`mp.weixin.qq.com` 域名下）时，插件在页面内注入“发布面板”。
    * 用户在面板点击开始后，插件自动抓取当前文章的最小字段：**标题**、**正文渲染后 HTML**、**原文链接（当前 URL）**。

2.  **自动化发布**：
    * 插件并发打开目标平台编辑页，并模拟用户操作完成填充与保存/发布。
    * 当前支持渠道（共 10 个）：`csdn / tencent-cloud-dev / cnblogs / oschina / woshipm / mowen / sspai / baijiahao / toutiao / feishu-docs`。
    * 支持动作：保存草稿、直接发布（成功口径以平台页面可见状态为准）。

#### 3. 核心技术约束

* **纯前端实现**：**禁止使用任何后端服务器**。所有的数据处理和自动化操作必须在用户的浏览器中，通过 Chrome 插件自身的能力完成。
* **兼容性**：优先确保在最新版 Chrome 浏览器上稳定运行。
* **图片策略（本期）**：不做图片上传，默认复用原文外链；如平台限制外链导致图片不可用，需在面板诊断区提示用户手动处理。

#### 4. 技术架构与实现方案

本项目采用纯粹的 Chrome Extension 架构，主要由三部分协作完成：

1.  **内容脚本 (Content Script - for WeChat)**
    * **职责**：注入到微信公众号文章页面，负责 DOM 解析和数据提取。
    * **实现**：使用标准 Web API (`document.querySelector`, `element.innerHTML`) 即可。定位标题选择器（如 `#activity-name`）和正文容器选择器（如 `#js_content`），提取数据后通过 `chrome.runtime.sendMessage` 发送给后台脚本。

2.  **后台脚本 (Background Script / Service Worker)**
    * **职责**：作为插件的大脑，负责流程调度。
    * **实现**：
        * 监听来自内容脚本的消息。
        * 接收到文章数据后，调用 `chrome.tabs.create` 并发创建目标渠道的编辑页标签页。
        * 维护“任务上下文”（jobId、渠道、状态），并将状态变化广播回微信页面板的诊断区。

3.  **内容脚本 (Content Script - for Platforms)**
    * **职责**：在各目标平台的编辑页执行自动化操作（填写标题/正文/保存草稿/提交发布），并将阶段与结果回传给后台脚本。
    * **通用策略**：
        * 等待动态元素加载（`waitForElement`）。
        * 模拟用户交互（聚焦、输入、点击、插入 HTML）。
        * 若平台“原文链接字段”不可在原创模式下使用，则统一将原文链接追加到正文末尾。

#### 5. 交付产物

* 一个完整的 Chrome Extension 项目文件夹，包含 `manifest.json`、background 脚本、content 脚本及所有必要的资源。
* 需求与验收口径以 `docs/V2.md` 与 `docs/V2-0.md`~`docs/V2-10.md` 为准。
