# V2-4：模块（诊断）——失败处理与诊断区规范（用户可读 + 本地开发详细）

## 1. 目的与范围
- 统一定义诊断区需要展示的内容、层级与可读性要求。
- 本文仅定义“展示什么、何时展示、成功/失败如何描述”，不包含实现细节。

## 2. 诊断区信息分级（必须）
诊断区必须支持两级信息：

### 2.1 用户可读提示（默认展示）
要求：
- 一句话说明“发生了什么”（原因/阶段）
- 给出“下一步怎么做”（可操作建议）
- 不暴露实现细节（例如不直接展示 selector/内部异常堆栈）

### 2.2 本地开发详细信息（仅本地开发构建展示）
要求：
- 展示更详细的步骤记录与诊断信息，用于排查问题。
- 是否展示由构建脚本现有判断方式决定（例如 `BUILD_TARGET`），开发者无需额外关心（口径见 `V2-0`）。

## 3. 诊断区需要覆盖的通用字段（需求级）
### 3.1 用户可读层（建议字段）
- 当前执行的渠道名称
- 当前步骤名称（例如：抓取/打开编辑页/填充标题/填充正文/保存草稿/提交发布/确认成功）
- 成功/失败状态
- 失败原因（用户可理解）
- 建议操作（用户可执行）

### 3.2 本地开发详细层（建议字段）
- 抓取源 URL、页面类型判断结果
- 抓取结果的字段完整性（例如标题长度/正文长度/是否为空）
- 执行阶段耗时（按步骤）
- 关键节点缺失信息（例如“未找到标题输入框/未找到编辑器/未找到发布按钮”等的抽象描述）
- 平台提示/弹窗是否出现的记录（抽象描述即可）

## 4. 必须覆盖的失败类型与提示规范
### 4.1 目标平台未登录
用户可读提示：
- “目标平台未登录，请先登录后重试”
建议操作：
- “打开目标平台登录完成后点击重试”

### 4.2 风控/验证码
用户可读提示：
- “检测到验证码/风控，请在当前标签页完成验证后继续”
建议操作：
- “完成验证后点击继续/重试”

### 4.3 内容超限/格式不支持
用户可读提示：
- “内容可能超限或包含不支持的格式”
建议操作（至少其一）：
- “移除复杂样式/减少图片/缩短标题或摘要/拆分为多篇后再尝试”

### 4.4 DOM 结构变更导致抓取或填表失败
用户可读提示：
- “页面结构可能已变更，导致无法完成抓取/填充”
建议操作：
- “刷新页面重试；或稍后再试；或反馈问题并附带诊断信息（本地开发可见）”

## 5. 成功提示规范（必须）
### 5.1 草稿成功
- 必须输出“草稿已保存/已落地”的可见依据（口径见 `V2-0`）。

### 5.2 发布成功
- 必须输出“已发布成功”的可见依据（口径见 `V2-0`）。

## 6. 依赖关系
- 本文被 `V2-1` ~ `V2-10` 引用。
- “本地开发/生产”的判定口径见 `V2-0`。

